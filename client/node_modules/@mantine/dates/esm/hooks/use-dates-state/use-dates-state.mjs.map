{"version":3,"file":"use-dates-state.mjs","sources":["../../../src/hooks/use-dates-state/use-dates-state.ts"],"sourcesContent":["import dayjs from 'dayjs';\nimport { useState } from 'react';\nimport { DatePickerType, PickerBaseProps } from '../../types';\nimport { useUncontrolledDates } from '../use-uncontrolled-dates/use-uncontrolled-dates';\nimport { isInRange } from './is-in-range/is-in-range';\n\ninterface UseDatesRangeInput<Type extends DatePickerType = 'default'>\n  extends PickerBaseProps<Type> {\n  level: 'year' | 'month' | 'day';\n  type: Type;\n  onMouseLeave?(event: React.MouseEvent<HTMLDivElement>): void;\n  applyTimezone?: boolean;\n}\n\nexport function useDatesState<Type extends DatePickerType = 'default'>({\n  type,\n  level,\n  value,\n  defaultValue,\n  onChange,\n  allowSingleDateInRange,\n  allowDeselect,\n  onMouseLeave,\n  applyTimezone = true,\n}: UseDatesRangeInput<Type>) {\n  const [_value, setValue] = useUncontrolledDates({\n    type,\n    value,\n    defaultValue,\n    onChange,\n    applyTimezone,\n  });\n\n  const [pickedDate, setPickedDate] = useState<Date | null>(\n    type === 'range' ? (_value[0] && !_value[1] ? _value[0] : null) : null\n  );\n  const [hoveredDate, setHoveredDate] = useState<Date | null>(null);\n\n  const onDateChange = (date: Date) => {\n    if (type === 'range') {\n      if (pickedDate instanceof Date && !_value[1]) {\n        if (dayjs(date).isSame(pickedDate, level) && !allowSingleDateInRange) {\n          setPickedDate(null);\n          setHoveredDate(null);\n          setValue([null, null]);\n          return;\n        }\n\n        const result: [Date, Date] = [date, pickedDate];\n        result.sort((a, b) => a.getTime() - b.getTime());\n        setValue(result);\n        setHoveredDate(null);\n        setPickedDate(null);\n        return;\n      }\n\n      if (\n        _value[0] &&\n        !_value[1] &&\n        dayjs(date).isSame(_value[0], level) &&\n        !allowSingleDateInRange\n      ) {\n        setPickedDate(null);\n        setHoveredDate(null);\n        setValue([null, null]);\n        return;\n      }\n\n      setValue([date, null]);\n      setHoveredDate(null);\n      setPickedDate(date);\n      return;\n    }\n\n    if (type === 'multiple') {\n      if (_value.some((selected: Date) => dayjs(selected).isSame(date, level))) {\n        setValue(_value.filter((selected: Date) => !dayjs(selected).isSame(date, level)));\n      } else {\n        setValue([..._value, date]);\n      }\n\n      return;\n    }\n\n    if (_value && allowDeselect && dayjs(date).isSame(_value, level)) {\n      setValue(null);\n    } else {\n      setValue(date);\n    }\n  };\n\n  const isDateInRange = (date: Date) => {\n    if (pickedDate instanceof Date && hoveredDate instanceof Date) {\n      return isInRange(date, [hoveredDate, pickedDate]);\n    }\n\n    if (_value[0] instanceof Date && _value[1] instanceof Date) {\n      return isInRange(date, _value);\n    }\n\n    return false;\n  };\n\n  const onRootMouseLeave =\n    type === 'range'\n      ? (event: React.MouseEvent<HTMLDivElement>) => {\n          onMouseLeave?.(event);\n          setHoveredDate(null);\n        }\n      : onMouseLeave;\n\n  const isFirstInRange = (date: Date) => {\n    if (!(_value[0] instanceof Date)) {\n      return false;\n    }\n\n    if (dayjs(date).isSame(_value[0], level)) {\n      return !(hoveredDate && dayjs(hoveredDate).isBefore(_value[0]));\n    }\n\n    return false;\n  };\n\n  const isLastInRange = (date: Date) => {\n    if (_value[1] instanceof Date) {\n      return dayjs(date).isSame(_value[1], level);\n    }\n\n    if (!(_value[0] instanceof Date) || !hoveredDate) {\n      return false;\n    }\n\n    return dayjs(hoveredDate).isBefore(_value[0]) && dayjs(date).isSame(_value[0], level);\n  };\n\n  const getControlProps = (date: Date) => {\n    if (type === 'range') {\n      return {\n        selected: _value.some(\n          (selection: Date) => selection && dayjs(selection).isSame(date, level)\n        ),\n        inRange: isDateInRange(date),\n        firstInRange: isFirstInRange(date),\n        lastInRange: isLastInRange(date),\n        'data-autofocus': (!!_value[0] && dayjs(_value[0]).isSame(date, level)) || undefined,\n      };\n    }\n\n    if (type === 'multiple') {\n      return {\n        selected: _value.some(\n          (selection: Date) => selection && dayjs(selection).isSame(date, level)\n        ),\n        'data-autofocus': (!!_value[0] && dayjs(_value[0]).isSame(date, level)) || undefined,\n      };\n    }\n\n    const selected = dayjs(_value).isSame(date, level);\n    return { selected, 'data-autofocus': selected || undefined };\n  };\n\n  const onHoveredDateChange = type === 'range' && pickedDate ? setHoveredDate : () => {};\n\n  return {\n    onDateChange,\n    onRootMouseLeave,\n    onHoveredDateChange,\n    getControlProps,\n    _value,\n    setValue,\n  };\n}\n"],"names":[],"mappings":"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"}